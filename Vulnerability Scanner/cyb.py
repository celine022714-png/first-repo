import vulnerabscanner as portscanner

targets_ip = input('[+] * Enter Target To Scan For Vulnerable Open Ports: ')
port_input = input('[+] * Enter Ports To Scan (comma separated, e.g., 21,22,80): ')
vul_file = input('[+] * Enter Path To The File With Vulnerable Softwares: ')

def parse_ports(ports_input):
    ports = set()

    if '-' in ports_input:  # range like 1-100
        start, end = ports_input.split('-')
        ports.update(range(int(start), int(end) + 1))

    elif ',' in ports_input:  # list like 80,443,22
        ports.update(int(p.strip()) for p in ports_input.split(','))

    else:  # single port
        ports.add(int(ports_input.strip()))

    return sorted(ports)

ports_to_scan = parse_ports(port_input)

target = portscanner.portscan(targets_ip, ports_to_scan)
target.scan()

print("\n[DEBUG] Open ports found:", target.open_ports)
print("[DEBUG] Banners grabbed:")
for b in target.banners:
    print("   ->", repr(b))
print()

try:
    with open(vul_file,'r') as file:
        count = 0
        for banner in target.banners:
            file.seek(0)
            for line in file.readlines():
                if line.strip() in banner:
                     print('[!!] VULNERABLE BANNER: "' + banner + '" ON PORT: ' + str(target.open_ports[count]))
                     count += 1
                if count == 0:
                    print("[*] No vulnerable banners matched the list in", vul_file)
except FileNotFoundError:
    print(f"[!] File not found: {vul_file}")
except PermissionError:
    print(f"[!] No permission to read: {vul_file}. Try moving it to C:\\Scripts.")
